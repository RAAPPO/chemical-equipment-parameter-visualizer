{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Dashboard - Admin Portal{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">Admin Dashboard</h1>
    <p class="page-subtitle">Manage datasets, equipment, and system settings</p>
</div>

<div class="dashboard-grid">
    <!-- Datasets Card -->
    <div class="card">
        <div class="card-header">
            <div>
                <div class="card-title">Total Datasets</div>
                <div class="card-value">{{ dataset_count }}</div>
                <div class="card-label">CSV files uploaded</div>
            </div>
            <div class="card-icon">ğŸ“Š</div>
        </div>
        <div class="card-actions">
            <a href="{% url 'admin:api_dataset_changelist' %}" class="card-link">View all datasets â†’</a>
        </div>
    </div>

    <!-- Equipment Card -->
    <div class="card">
        <div class="card-header">
            <div>
                <div class="card-title">Total Equipment</div>
                <div class="card-value">{{ equipment_count }}</div>
                <div class="card-label">Equipment records</div>
            </div>
            <div class="card-icon">âš™ï¸</div>
        </div>
        <div class="card-actions">
            <a href="{% url 'admin:api_equipment_changelist' %}" class="card-link">View all equipment â†’</a>
        </div>
    </div>

    <!-- Users Card -->
    <div class="card">
        <div class="card-header">
            <div>
                <div class="card-title">System Users</div>
                <div class="card-value">{{ user_count }}</div>
                <div class="card-label">Registered users</div>
            </div>
            <div class="card-icon">ğŸ‘¥</div>
        </div>
        <div class="card-actions">
            <a href="{% url 'admin:auth_user_changelist' %}" class="card-link">Manage users â†’</a>
        </div>
    </div>

    <!-- Outliers Card -->
    <div class="card">
        <div class="card-header">
            <div>
                <div class="card-title">Outliers Detected</div>
                <div class="card-value" style="color: #EF4444;">{{ outlier_count }}</div>
                <div class="card-label">Equipment with alerts</div>
            </div>
            <div class="card-icon">âš ï¸</div>
        </div>
        <div class="card-actions">
            <span class="card-link" style="color: #6B7280;">Monitoring active</span>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="card">
    <div class="card-header">
        <h2 style="font-size: 1.25rem; font-weight: 700; color: #1F2937;">Quick Actions</h2>
    </div>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{% url 'admin:api_dataset_add' %}" class="btn btn-primary">â• Add Dataset</a>
        <a href="{% url 'admin:api_equipment_add' %}" class="btn btn-success">â• Add Equipment</a>
        <a href="{% url 'admin:auth_user_add' %}" class="btn btn-secondary">â• Add User</a>
        <a href="/api/" target="_blank" class="btn btn-secondary">ğŸ”— View API</a>
    </div>
</div>

<!-- Recent Activity -->
<div class="card" style="margin-top: 1.5rem;">
    <div class="card-header">
        <h2 style="font-size: 1.25rem; font-weight: 700; color: #1F2937;">Recent Datasets</h2>
    </div>
    <div class="data-table">
        <table>
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Equipment Count</th>
                    <th>Uploaded</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for dataset in recent_datasets %}
                <tr>
                    <td><strong>ğŸ“„ {{ dataset.filename }}</strong></td>
                    <td><span class="badge badge-info">{{ dataset.total_equipment }}</span></td>
                    <td>{{ dataset.uploaded_at|date:"M d, Y" }}</td>
                    <td>
                        <a href="{% url 'admin:api_dataset_change' dataset.id %}" class="btn btn-secondary"
                            style="padding: 0.375rem 0.75rem; font-size: 0.75rem;">View</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" style="text-align: center; color: #9CA3AF;">No datasets yet</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}